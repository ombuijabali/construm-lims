<!DOCTYPE html>
<html lang="en">
<head>
    <title>Construm LIMS </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="https://cdn.leafletjs.com/leaflet-0.7.2/leaflet.ie.css" /><![endif]-->
    <link rel="shortcut icon" type="image/x-icon" href="logo.ico">
    <link rel="stylesheet" href="Leaflet.Coordinates-0.1.5.css" />
    <link rel="stylesheet" href="leaflet-sidebar.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <link rel="stylesheet" href="leaflet-measure.css" />
    <link rel="stylesheet" href="leaflet.groupedlayercontrol.min.css" />
    <link rel="stylesheet" href="dist/leaflet-ruler.css" />
    <link rel="stylesheet" href="leaflet.draw.css">
    <link rel="stylesheet" href="Control.FullScreen.css" />
    <link rel="stylesheet" href="leaflet.measurecontrol.css" />
    <style>
        body {
            padding: 0;
            margin: 0;
        }

        html, body, #map {
            height: 100%;
            font: 10pt "Helvetica Neue", Arial, Helvetica, sans-serif;
        }

        .lorem {
            font-style: italic;
            color: #AAA;
        }

        #sidebar {
            top: 75px;
            height: 100%;
        }

        #print-control {
            padding: 10px;
        }

        .title-section {
            background-color: cadetblue;
            color: #fff;
            padding: 3px;
            text-align: left;
            margin-bottom: -20px;
            height:70px;
        }

        .logo img {
            width: 60px; /* change the width to your desired value */
            height: 100px;
            margin-left: 20px; /* maintain the aspect ratio */
        }

        .logo, .title {
            display: inline-block;
            vertical-align: middle;
        }

        .leaflet-top.leaflet-right {
            z-index: 999;
        }

        #search-icon {
            display: flex;
            height: 100%;
            align-items: center;
        }

            #search-icon i {
                font-size: 24px;
                cursor: pointer;
            }

                #search-icon i:before {
                    content: "\f002";
                }

            #search-icon:hover i:before {
                color: #0078A8;
            }

            #search-icon:hover {
                background-color: #E8F1F8;
            }

        .search-input-wrapper {
            position: relative;
        }

            .search-input-wrapper input {
                width: 100%;
                border: none;
                border-bottom: 1px solid #ccc;
                font-size: 1.2em;
                padding: 0.5em;
            }

                .search-input-wrapper input:focus {
                    outline: none;
                    border-bottom: 2px solid blue;
                }

            .search-input-wrapper:before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                border-bottom: 1px solid #ccc;
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.3s ease-in-out;
            }

            .search-input-wrapper:hover:before,
            .search-input-wrapper:focus:before {
                opacity: 1;
            }

        .title-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .search-input-wrapper {
            display: flex;
            align-items: center;
            border: solid;
            border-radius: 10px;
        }

        #search-button {
            margin-left: 10px;
        }

        .help-button {
            background-color: brown;
            color: white;
            border-radius: 5px;
            padding: 10px;
            text-align: center;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: 90%;
            z-index: 9999;
        }

            .help-button:hover {
                cursor: pointer;
                background-color: #8b5a2b;
            }

        .home-button {
            position: absolute;
            background-size: contain;
            color: green;
            width: 32px;
            height: 32px;
            cursor: pointer;
            transition: background-color 0s;
            right: 5px;
            top: 120px;
        }

        #map {
            position: relative;
            height: 100%;
            margin: 20px auto;
            background-color: transparent;
        }

        .custom-table {
            border-collapse: collapse;
        }

            .custom-table td {
                border: 1px solid black;
                padding: 5px;
            }

        #tableContainer {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        body {
            background-color: white;
        }

        .parcel-links {
            display: flex;
            justify-content: flex-start;
            margin-bottom: 10px;
            margin-top: 20px;
            border: 1px solid black;
            border-radius: 10px;
            background-color: cadetblue;
        }

        .parcel-link {
            margin: 0 10px;
            display: flex;
            align-items: center;
            border: 1px solid black;
            color: brown;
            margin-top: 10px;
            margin-bottom: 10px;
        }

            .parcel-link input {
                margin-right: 5px;
                background-color: #f5f5f5;
                border: 1px solid brown;
                color: brown;
                font-size: 12px;
            }

                .parcel-link input::placeholder {
                    color: brown;
                }

            .parcel-link .search-button {
                background: none;
                border: none;
                padding: 0;
                cursor: pointer;
                color: brown;
            }

        #parcelTable {
            display: none;
            margin-top: 20px;
            border-collapse: collapse;
        }

            #parcelTable th,
            #parcelTable td {
                padding: 8px;
                border: 1px solid #ccc;
            }

        .login-button,
        .register-button {
            display: inline-block;
            padding: 10px 20px;
            background-color: brown;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            margin-left: 120px;
        }

            .login-button:hover,
            .register-button:hover {
                background-color: white;
            }

        .search-field {
            margin-bottom: 10px;
        }

            .search-field label {
                display: inline-block;
                width: 120px;
                margin-right: 10px;
            }

            .search-field input[type="text"],
            .search-field select {
                padding: 8px;
                border: 1px solid #ddd;
                width: 200px;
            }

        .input-with-icon {
            position: relative;
        }

            .input-with-icon input[type="text"] {
                padding-right: 30px;
            }

            .input-with-icon i {
                position: absolute;
                top: 50%;
                right: 10px;
                transform: translateY(-50%);
                color: #aaa;
            }

        .search-buttons {
            margin-top: 20px;
        }

            .search-buttons button {
                padding: 8px 16px;
                margin-right: 10px;
                background-color: #4caf50;
                color: #fff;
                border: none;
                cursor: pointer;
            }

                .search-buttons button:last-child {
                    margin-right: 0;
                    background-color: #f44336;
                }

        .result-table-wrapper {
            position: absolute;
            top: 200px; /* Adjust the positioning as needed */
            right: 500px; /* Adjust the positioning as needed */
            background-color: transparent;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 10px;
            z-index: 1000;
        }


        .custom-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ddd;
        }

            .custom-table th,
            .custom-table td {
                padding: 8px;
                border: 1px solid #ddd;
                color: white;
            }

            .custom-table th {
                background-color: #f5f5f5;
                font-weight: bold;
                text-align: left;
            }

            .custom-table tbody tr:nth-child(even) {
                background-color: #f9f9f9;
            }

        #result-table-heading {
            display: block;
            color: brown;
        }

        #result-table {
            border-collapse: collapse;
            width: 100%;
        }

            #result-table th,
            #result-table td {
                border: 1px solid #000;
                padding: 8px;
            }

            #result-table th {
                background-color: cadetblue;
            }

            #result-table tr:nth-child(even) {
                background-color: #ddd;
            }

            #result-table tr:hover {
                background-color: white;
            }

        .result-table tr:nth-child(even) {
            background-color: lightgray;
        }

        .result-table tr:nth-child(odd) {
            background-color: white;
        }

        .section-heading {
            color: green;
        }

        #button.logout-btn {
            color: red;
            font-style: italic;
            border: 1px solid brown;
            border-radius: 10px;
        }

        #map {
            position: relative;
            z-index: 0;
        }

        #attribute-table {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            background-color: transparent;
            padding: 10px;
            max-width: 1000px; /* Adjust the width as needed */
        }

            #attribute-table table {
                width: 100%;
                border-collapse: collapse;
            }

            #attribute-table th,
            #attribute-table td {
                padding: 8px;
                border: 1px solid #ccc;
            }

            #attribute-table th {
                background-color: cadetblue;
                color: white;
            }

            #attribute-table td {
                background-color: #f5f5f5;
            }

                #attribute-table td:first-child {
                    font-weight: bold;
                }

            #attribute-table tr:nth-child(even) td {
                background-color: #e9e9e9;
            }

            #attribute-table tr:hover td {
                background-color: #d1d1d1;
            }

        /* CSS for layer control container */
        .sidebar .leaflet-control-layers {
            width: 100%;
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            margin-left: -10px;
        }

            /* CSS for layer control header */
            .sidebar .leaflet-control-layers .leaflet-control-layers-header {
                font-weight: bold;
                color: brown;
                cursor: pointer;
            }

            /* CSS for layer control subheader */
            .sidebar .leaflet-control-layers .leaflet-control-layers-subheader {
                margin-top: 8px;
                font-weight: bold;
                color: brown;
                cursor: pointer;
            }

        /* CSS for layer control overlay labels */
        .sidebar .leaflet-control-layers-list .leaflet-control-layers-label {
            display: block;
            margin-left: 30px;
        }

        /* CSS for layer control overlay inputs */
        .sidebar .leaflet-control-layers-list .leaflet-control-layers input[type="checkbox"] {
            margin-left: 10px;
        }

        /* CSS for expanded layer control overlay lists */
        .sidebar .leaflet-control-layers-list .leaflet-control-layers-group {
            display: block;
        }

            /* CSS for collapsed layer control overlay lists */
            .sidebar .leaflet-control-layers-list .leaflet-control-layers-group.collapsed {
                display: none;
            }

        .feature-table {
            border-collapse: collapse;
            width: 100%;
        }

            .feature-table td, .feature-table th {
                border: 1px solid #ddd;
                padding: 8px;
            }

            .feature-table tr:nth-child(even) {
                background-color: #f2f2f2;
            }

            .feature-table tr:nth-child(odd) {
                background-color: #f2f2f2;
            }

            .feature-table tr:hover {
                background-color: #ddd;
            }

            .feature-table th {
                padding-top: 12px;
                padding-bottom: 12px;
                text-align: left;
                background-color: #4CAF50;
                color: white;
            }

        #user-welcome {
            margin-left: 700px;
            margin-top: -16px;
            color: yellow;
            font-size: 18px;
            font-style: italic;
            font-weight: bold;
        }


        #logoutForm {
            display: flex;
            align-items: center;
        }

            #logoutForm button {
                margin-left: 10px;
                background-color: transparent;
                border: none;
                cursor: pointer;
            }

        .profile-icon {
            float: right;
            font-size: 30px;
            margin-right: 10px;
            color: white;
        }

        .profile-form-container {
            position: absolute;
            top: 50px; /* Adjust the top position as needed */
            right: 400px; /* Adjust the right position as needed */
            background-color: transparent;
            padding: 20px;
            z-index: 9999;
        }

        .profile-section {
            display: flex;
            align-items: center;
        }

        .profile-name {
            margin-left: auto;
            color: whitesmoke;
            font-size: 14px;
            font-style: italic;
        }

        .form-container {
            width: 500px;
            margin: -130px auto 300px;
            padding: 20px;
            background-color: #f8f9fa;
            border: 1px solid #ccc;
            border-radius: 5px;
            position: relative;
            top: -30px;
            left: -20px;
        }


            .form-container h3 {
                font-size: 24px;
                font-weight: bold;
                color: #6c757d;
                margin-bottom: 20px;
            }

            .form-container label {
                font-size: 16px;
                font-weight: bold;
                color: brown;
                font-style: italic;
                display: block;
                margin-bottom: 5px;
            }

            .form-container input[type="text"],
            .form-container input[type="password"],
            .form-container input[type="email"],
            .form-container select {
                width: 80%;
                padding: 8px;
                border: 1px solid #ccc;
                border-radius: 4px;
                margin-bottom: 10px;
                font-family: Arial, sans-serif;
                font-size: 14px;
            }

            .form-container button[type="submit"] {
                background-color: #007bff;
                color: #fff;
                border: none;
                padding: 10px 20px;
                border-radius: 4px;
                cursor: pointer;
                font-family: Arial, sans-serif;
                font-size: 16px;
            }

                .form-container button[type="submit"]:hover {
                    background-color: #0056b3;
                }

            .form-container .row {
                margin-bottom: 15px;
            }

            .form-container .col-md-4 {
                width: 33.33%;
                float: left;
            }

                .form-container .col-md-4:first-child {
                    margin-right: 5%;
                }

                .form-container .col-md-4:last-child {
                    margin-left: 5%;
                }

            .form-container .avatar-container {
                text-align: center;
                margin-bottom: 20px;
            }

            .form-container .avatar {
                position: relative;
                display: inline-block;
                width: 140px;
                height: 120px;
            }

                .form-container .avatar i {
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    font-size: 140px;
                    color: cadetblue;
                    cursor: pointer;
                }

                .form-container .avatar input[type="file"] {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    opacity: 0;
                    cursor: pointer;
                }

        .fullscreen-button {
            position: absolute;
            font-display: auto;
            z-index: 1000;
        }
        .leaflet.measure-control {
            background-color: red; /* Change to your desired color */
            color: #ffffff; /* Change to your desired text color */
            border-radius: 4px;
            padding: 6px 12px;
        }

        .contact-form {
            max-width: 400px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }

            .contact-form h2 {
                text-align: center;
                margin-bottom: 20px;
            }

            .contact-form form {
                display: flex;
                flex-direction: column;
            }

            .contact-form input,
            .contact-form textarea {
                margin-bottom: 10px;
                padding: 10px;
                border-radius: 5px;
                border: 1px solid #ccc;
            }

            .contact-form button {
                background-color: brown;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 5px;
                cursor: pointer;
            }
        .faq-section {
            margin-top: 20px;
        }

        .faq-item {
            margin-bottom: 10px;
        }

            .faq-item h3 {
                font-weight: bold;
            }
    </style>
</head>
<body>
    <div class="title-section">
        <header>
            <div class="logo">
                <img src="down.png" alt="Construm Land Portal Logo">
            </div>
            <h1 class="title" style="display:inline-block;"> | Construm Land Information Portal</h1>
            <div id="user-welcome"></div> <!-- Placeholder for the welcome message -->
        </header>
        <div class="search-input-wrapper">
            <input type="text" id="search-input" placeholder="Enter a Plot No. to search">
            <button id="search-button"><i class="fa fa-search"></i></button>
        </div>
        <div class="profile-section">
            <span class="profile-icon" onclick="toggleProfileForm()"><i class="fas fa-user-circle"></i></span>
            <span class="profile-name"><i>Profile</i></span>
        </div>
        <form id="logoutForm" action="/api/logout" method="post">
            <button type="button" onclick="confirmLogout()">
                <i class='fas fa-sign-out-alt' style='font-size:36px;color:black'></i>
            </button>
            <span class="logout-name"><i>Logout</i></span> <!-- Replace "John Doe" with the desired name -->
        </form>

    </div>



    <div id="sidebar" class="sidebar collapsed">
        <!-- Nav tabs -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li class="active"><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
                <li><a href="#layers" role="tab"><i class="fa fa-map"></i></a></li>
                <li><a href="#search" role="tab"><i class="fa fa-search"></i></a></li>
                <li><a href="#user" role="tab"><i class="fa fa-user"></i></a></li>
                <li><a href="#info" role="tab"><i class="fa fa-info"></i></a></li>

            </ul>
            <ul role="tablist">
                <li><a href="#settings" role="tab"><i class="fa fa-cog"></i></a></li>
            </ul>
        </div>

        <!-- Tab panes -->
        <div class="sidebar-content collapsed">
            <div class="sidebar-pane" id="home">
                <h1 class="sidebar-header">
                    <i>Home</i>
                    <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>
                <p style="color:brown; font-size:18px;">
                    <i>
                        Construm-LIMS is an online platform system that provides information about parcels and their owners, as well as the corresponding utilities close to the parcel. This information allows individuals to determine the value of the parcel.<br>
                        <br>The land information portal displays land parcel information located in Kakamega town in Western Kenya.
                    </i>
                </p>
                <p><b><i>Designed and developed by <a href="https://construmgis.com/" target="_blank">Construm</a>.</i></b></p>
            </div>
            <div class="sidebar-pane" id="layers">
                <h1 class="sidebar-header"><i>Layers</i></h1>
                <div id="layer-control"></div>
            </div>
            <div class="sidebar-pane" id="user">
                <h1 class="sidebar-header"><i>Adminstration</i></h1>
                <div id="search-form">
                    <div class="search-field">
                        <label for="layer-type">Layer Type:</label>
                        <select id="layer-type">
                            <option value="parcels">Ownership Details</option>
                            <option value="survey">Survey Coordinates</option>
                            <option value="valuation">Parcel Valuation</option>
                            <option value="revenue">Revenue Details</option>
                        </select>
                    </div>
                    <div class="search-field">
                        <label for="id">ID:</label>
                        <input type="text" id="id" placeholder="Enter ParcelID">
                    </div>
                    <div class="search-field">
                        <label for="owner-name">Owner Name:</label>
                        <input type="text" id="owner-name" placeholder="Owner Name">
                    </div>
                    <div class="search-field">
                        <label for="version-status">Version Status:</label>
                        <input type="text" id="version-status" placeholder="Version Status">
                    </div>
                    <div class="search-field">
                        <label for="geometry-type">Geometry Type:</label>
                        <input type="text" id="geometry-type" placeholder="Geometry Type">
                    </div>
                    <div class="search-field">
                        <label for="last-change-from">Last Change From:</label>
                        <input type="date" id="last-change-from">
                    </div>
                    <div class="search-field">
                        <label for="last-change-to">Last Change To:</label>
                        <input type="date" id="last-change-to">
                    </div>
                    <!-- Add more search fields for additional parameters -->
                    <div class="search-field">
                        <label for="plot-number">Plot Number:</label>
                        <input type="text" id="plot-number" placeholder="Plot Number">
                    </div>
                    <div class="search-field">
                        <label for="plot-size">Plot Size:</label>
                        <input type="text" id="plot-size" placeholder="Plot Size">
                    </div>
                    <div class="search-buttons">
                        <button id="query-button">Query</button>
                        <button id="clear-button">Clear</button>
                    </div>
                </div>
            </div>
            <div class="sidebar-pane" id="search">
                <h1 class="sidebar-header"><i>Search</i></h1>
                <div id="search-form">
                    <div class="search-field">
                        <label for="layer-type">Layer Type:</label>
                        <select id="layer-type">
                            <option value="cadastral">Cadastral</option>
                            <option value="buildings">Buildings</option>
                            <option value="water">Water</option>
                            <option value="vegetation">Vegetation</option>

                        </select>
                    </div>
                    <div id="dynamic-input-field" class="search-field"></div>
                    <div class="search-buttons">
                        <button id="query-button">Query</button>
                        <button id="clear-button">Clear</button>
                    </div>
                </div>
            </div>
            <div class="sidebar-pane" id="results">
                <h1 class="sidebar-header">Results</h1>
                <div id="result-details"></div>
                <hr>
                <div id="coordinate-reference-system"></div>
                <div id="scale"></div>
            </div>
           
            <div class="sidebar-pane" id="info">
                <div class="faqs">
                    <h2 style="color:black;">Frequently Asked Questions</h2>

                    <h3 style="color:brown;" onclick="toggleAnswer(1)"><i>What's Construm-LIMS</i></h3><br>
                    <p class="black-text" id="answer1" style="display: none;">
                        Construm-LIMS IS land information management system developed by Construm Kenya Ltd to allow land owner access the land information
                        and be able to value their land based on different aspects like accessibility, security, availability of social amenities etc..
                    </p>


                    <!-- Repeat the same pattern for other questions and answers -->
                    <!-- Land Tenure -->
                    <h3 style="color:brown;" onclick="toggleAnswer(2)"><i>How do I Login and use Construm-LIMS upon Registration</i></h3><br>
                    <p class="black-text" id="answer2" style="display: none;">
                        <i class="brown-text" style="font-size: 16px;">Notification bell</i>: Displays all unread notifications sent;<br>

                        <i class="brown-text" style="font-size: 16px;">Profile icon:</i> Displays the name of the person or company logged in and any added professional account after an upgrade;<br>

                        <i class="brown-text" style="font-size: 16px;">My Properties:</i> This link contains two other links which include:<br>

                        <i class="brown-text" style="font-size: 16px;">Enumeration link:</i> Displays properties owned by the person who has logged into the system.<br>

                        <i class="brown-text" style="font-size: 16px;">My properties link:</i> Displays properties owned by a user.<br>

                        <i class="brown-text" style="font-size: 16px;">Appointments:</i> Allows a user to schedule appointment(s) with officers from the County;<br>

                        <i class="brown-text" style="font-size: 16px;">Notifications:</i> Displays all notifications sent. The notifications are sorted out based on their status i.e., unread, read and all notifications;<br><br>
                        <b>How do I access a service that I need on Construm-LIMS?</b><br>

                        To access a service on this platform, the user is required to navigate to the service tab that offers it i.e. the Department of Lands and Physical Planning.

                        Under the options provided, the applicant can locate a service of interest. Each application contains additional FAQs for further guidance.
                    </p>


                    <!-- Land Value -->
                    <!-- ... -->
                    <h3 style="color:brown;" onclick="toggleAnswer(3)"><i>What Documents are Required?</i></h3><br>
                    <p class="black-text" id="answer3" style="display: none; font-size: 19px;">You will be required to submit the following documents to be able to make an application for a service. They include <i class="brown-text">National or Military ID, Land ownership proof, Payment Receipt, Copy of approved plans.</i></p>

                    <!-- Land Use -->
                    <!-- ... -->
                    <h3 style="color:brown;" onclick="toggleAnswer(4)"><i>Land Tenure</i></h3><br>
                    <p class="black-text" id="answer4" style="display: none; font-size: 16px;">
                        Land tenure is about the relationship between people and the land, and how local laws and customs define that relationship. Without
                        security of tenure, households are significantly impaired in their ability to secure sufficient food and to enjoy sustainable rural livelihoods.
                    </p>


                    <h3 style="color:brown;" onclick="toggleAnswer(5)"><i>Land Registration FAQs</i></h3><br>
                    <p class="black-text" id="answer5" style="display: none;">
                        <i class="brown-text" style="font-size: 16px;">What is the role of an Advocate in the Registration process?:</i>

                        An Advocate acts as a witness on the output documents of Registration in addition to initiating the various processes on the platform;<br>

                        <i class="brown-text" style="font-size: 16px;">Caution:</i> Means a notice in the form of a register to the effect that no action of a specified nature in relation to the land in respect of which the notice has been entered may be taken without first informing the person who gave the notice;<br>

                        <i class="brown-text" style="font-size: 16px;">Charge:</i> Means an interest in land securing the payment of money or money’s worth or the fulfilment of any condition, and includes a subcharge and the instrument creating a charge;<br>

                        <i class="brown-text" style="font-size: 16px;">Long Term Lease:</i> Means a contract between the registered Proprietor (Lessor)and the Lessee that entitles the lessee to a limited real right over the property in question for an agreed period of time ranging from 21 years to 99 years;<br>

                        <i class="brown-text" style="font-size: 16px;">Registration of Personal Representative As Executor/ Administrator:</i> Means registering an individual(s) who will handle the property(ies) of a deceased on behalf of the beneficiaries of the said property(ies);<br>

                        <i class="brown-text" style="font-size: 16px;">Restriction:</i>Means an interest registered under section 76 and includes the Registrar’s caveat;<br>

                        <i class="brown-text" style="font-size: 16px;">Search:</i> Means an application made to confirm the ownership details and other interests that have been registered on that property;<br>

                        <i class="brown-text" style="font-size: 16px;">Severance of Joint Ownership</i>: Means termination of joint ownership of a property and registering proprietorship in common ownership where every owner has a share to the property;<br>

                        <i class="brown-text" style="font-size: 16px;">Short Term Lease:</i> Means a contract between the lessor and the lessee that entitles the lessee to a limited real right over the property in question for an agreed period of time not exceeding 21 years;<br>

                        <i class="brown-text" style="font-size: 16px;">Stamp Duty</i>: Means tax levied on legal instruments, property and land transactions;<br>

                        <i class="brown-text" style="font-size: 16px;">Transfer:</i> Means the passing of land, a lease or a charge from one party to another by an act of the parties and not by operation of the law and includes the instrument by which such passing is effected.
                    </p>

                    <!-- Land Ownership -->
                    <!-- ... -->
                    <h3 style="color:brown;" onclick="toggleAnswer(6)"><i>Physical Planning FAQs</i></h3><br>
                    <p class="black-text" id="answer6" style="display: none;">
                        <i class="brown-text" style="font-size: 16px;">Certificate of compliance:</i> Means a statutory tool issued by the State Department of Physical Planning to owners/developers of petrol stations for having adhered to the provisions of approval provided for development.<br>

                        <i class="brown-text" style="font-size: 16px;">Plan Request</i>: Means an application made to the Department of Physical Planning to request for an approved plan for some specific purposes.<br>

                        <i class="brown-text" style="font-size: 16px;">Approval of PDP:</i> Means an application made to the Department of Physical Planning to approve a plan used in the alienation of public land with the authority of the National Land Commission.
                    </p>


                    <h3 style="color:brown;" onclick="toggleAnswer(7)"><i>Surveying and Mapping FAQs</i></h3><br>
                    <p class="black-text" id="answer7" style="display: none;">
                        <i class="brown-text" style="font-size: 16px;">Amalgamation:</i> Means consolidation/combining of two or more parcels of land into one, and may include the creation of a public access road, usually via a scheme plan.<br>

                        <i class="brown-text" style="font-size: 16px;">New Grant:</i> Means the alienation of government land to effect the acquisition of the land to a new entity in the first registration of the property. Alienation is effected through a letter of allotment and Part Development Plan (PDP) from National Lands Commission (NLC) and Physical planning respectively.<br>

                        <i class="brown-text" style="font-size: 16px;">Subdivision:</i> Means the division of one parcel of land into two or more parcels, and may include the creation of private or public roads.<br>

                        <i class="brown-text" style="font-size: 16px;">Re-survey:</i> Means a request to the department of survey to do a new survey on an already surveyed parcel of land to confirm the boundaries..
                    </p>


                    <h3 style="color:brown;" onclick="toggleAnswer(8)"><i>Land Valuation FAQs</i></h3><br>
                    <p class="black-text" id="answer8" style="display: none;">
                        <i class="brown-text" style="font-size: 16px;">Arbitration</i>: Means process of resolving a disputed market value of a property.<br>

                        <i class="brown-text" style="font-size: 16px;">Asset valuation:</i> Means the process of determining the current value of assets or specific properties or assigning monetary value to an asset .<br>

                        <i class="brown-text" style="font-size: 16px;">County Agencies Purchase:</i> Means the buying of properties by government agencies.<br>

                        <i class="brown-text" style="font-size: 16px;">County Leasing:</i> Means an agreement between a government agency & an owner of the property (individual/ entity) where the owner agrees to rent its property to the government agency.<br>

                        <i class="brown-text" style="font-size: 16px;">Estate Administration:</i> Means process of determining market value of property(ies) belonging to a deceased.<br>

                        <i class="brown-text" style="font-size: 16px;">Land Use:</i> Means the present and future use and development of land in all its geographical areas and its resources.<br>

                        <i class="brown-text" style="font-size: 16px;">Loose Assets:</i> Means equipment that are installed or found on the property to be purchased.<br>

                        <i class="brown-text" style="font-size: 16px;">Valuation Certificate:</i> Means a document showing the determined value of the property.<br>

                        <i class="brown-text" style="font-size: 16px;">Valuation Report:</i> Means a document showing the methods used to determine the value of property.
                    </p>

                    <!-- Land Use -->
                </div>
            </div>

            <div class="sidebar-pane" id="settings">
                <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                <a href="https://construmgis.com/" target="_self" class="help-button">Help</a>
                <div class="contact-form" id="contact-form">
                    <h2 style="color:brown"><i>Contact Us</i></h2>
                    <form>
                        <input type="text" id="name-input" placeholder="Your Name">
                        <input type="text" id="purpose-input" placeholder="Purpose">
                        <textarea id="message-input" placeholder="Message"></textarea>
                        <button type="submit" class="submit-button">Submit</button>
                    </form>
                </div>
            </div>  
        </div>
    </div>

    <div class="leaflet-top leaflet-right">
        <div class="leaflet-control-zoomhome leaflet-bar leaflet-control">
            <a class="home-button" href="#" title="Zoom to Kakamega"><i class="fas fa-home"></i></a>
        </div>
    </div>
    <div id="map" class="sidebar-map">
        <h2 id="result-table-heading"></h2>
        <div class="result-table-wrapper">
            <table id="result-table" class="result-table">
                <thead id="result-table-header"></thead>
                <tbody id="result-table-content"></tbody>
            </table>
        </div>

        <div id="attribute-table">
            <div class="attribute-header">
                <button id="close-button" onclick="closeAttributeTable()" style="display: none;">Close</button>
            </div>
            <div id="table-content"></div>
        </div>
        <div class="profile-form-container" id="profileFormContainer" style="display: none;">
            <h3>Profile Information</h3>
            <form>
                <div class="form-container">
                    <div class="avatar-container">
                        <div class="avatar">
                            <i class="fas fa-user" style="font-size: 140px;"></i>
                            <input type="file" id="profile-photo" accept="image/*">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <label for="firstName" class="form-label">First Name</label>
                            <input type="text" class="form-control" id="firstName" required>
                        </div>
                        <div class="col-md-4">
                            <label for="middleName" class="form-label">Middle Name</label>
                            <input type="text" class="form-control" id="middleName">
                        </div>
                        <div class="col-md-4">
                            <label for="lastName" class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="lastName" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <label for="idType" class="form-label">ID Type</label>
                            <select id="idType" class="form-select" required>
                                <option selected disabled>Select ID Type</option>
                                <option value="national-id">National ID</option>
                                <option value="passport">Passport</option>
                                <option value="military">Military</option>
                                <!-- Add more ID types here -->
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="idNumber" class="form-label">ID Number</label>
                            <input type="text" class="form-control" id="idNumber" required>
                        </div>
                        <div class="col-md-4">
                            <label for="kraPin" class="form-label">KRA PIN</label>
                            <input type="text" class="form-control" id="kraPin" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <label for="address" class="form-label">Address</label>
                            <input type="text" class="form-control" id="address" placeholder="1234 Main St" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="city" class="form-label">City</label>
                            <input type="text" class="form-control" id="city" required>
                        </div>
                        <div class="col-md-4">
                            <label for="state" class="form-label">State</label>
                            <select id="state" class="form-select" required>
                                <option selected disabled>Choose...</option>
                                <option value="nairobi">Nairobi</option>
                                <option value="lamu">Lamu</option>
                                <option value="malindi">Malindi</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="zip" class="form-label">Zip</label>
                            <input type="text" class="form-control" id="zip" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="text-end">
                                <button type="submit" class="btn btn-primary">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div id="ruler-control" class="leaflet-control leaflet-bar"></div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="Leaflet.Coordinates-0.1.5.src.js"></script>
    <script src="leaflet-sidebar.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="https://unpkg.com/geojson-vt@3.2.0/geojson-vt.js"></script>
    <script src="leaflet-geojson-vt.js"></script>
    <script src="landuse.js"></script>
    <script src="Old_Town.js"></script>
    <script src="ADMIN.js"></script>
    <script src="buildings.js"></script>
    <script src="vegetation.js"></script>
    <script src="road.js"></script>
    <script src="water.js"></script>
    <script src="leaflet.browser.print.js"></script>
    <script src="leaflet-measure.js"></script>
    <script src="leaflet.groupedlayercontrol.min.js"></script>
    <script src="dist/leaflet-ruler.js"></script>
    <script src="leaflet.draw.js"></script>
    <script src="Control.FullScreen.js"></script>
    <script src="Leaflet.LocationShare.js"></script>
    <script src="leaflet.measurecontrol.js"></script>
    <script>
        var map = L.map('map', {
            fullscreenControl: true,
            fullscreenControlOptions: {
                position: 'topleft',
                content: '<img src="fullscreen.png" alt="Fullscreen" style="width: 25px; height: 25px;" />'
            }
        });

        map.setView([0.2808, 34.7557], 16);

        // Adding the satellite imagery basemap
        var satelliteLayer = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 25,
            id: 'mapbox/satellite-v9',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1Ijoic2ltaW9uMTIzIiwiYSI6ImNsZzZkaGJtcjBjZG8zcnFpcG1icHZ0MWEifQ.qs9HmzJglua2mUBOnoahQQ'
        }).addTo(map);

        // Adding the OSM basemap
        var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
            maxZoom: 25,
        });

        // Set the Mapbox basemap as the default basemap
        satelliteLayer.addTo(map);


        //Coordinates/ Mouse Position
        L.control.coordinates({
            position: "bottomright", //optional default "bootomright"
            useDMS: true,
            labelTemplateLat: "Latitude: {y}",
            labelTemplateLng: "Longitude: {x}",
            useLatLngOrder: true,
        }).addTo(map);

        //Scale Bar
        L.control.scale().addTo(map);

        $('.home-button').click(function () {
            map.setView([0.2829, 34.7519], 14);
        });

        var measureControl = new L.Control.Measure({
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares',
        });

        measureControl.addTo(map);

        // Create separate GeoJSON layers for each land use category
        var agriculturalLayer = L.geoJSON(use, {
            filter: function (feature) {
                return feature.properties.LandUse === 'Industrial';
            },
            style: {
                fillColor: '#FDFD96',
                fillOpacity: 0.8,
                weight: 1,
                color: 'black'
            }
        });

        var industrialLayer = L.geoJSON(use, {
            filter: function (feature) {
                return feature.properties.LandUse === 'Agricultural';
            },
            style: {
                fillColor: '#800080',
                fillOpacity: 0.8,
                weight: 1,
                color: 'black'
            }
        });

        var commercialLayer = L.geoJSON(use, {
            filter: function (feature) {
                return feature.properties.LandUse === 'Commercial';
            },
            style: {
                fillColor: '#FF0000',
                fillOpacity: 0.8,
                weight: 1,
                color: 'black'
            }
        });

        var residentialLayer = L.geoJSON(use, {
            filter: function (feature) {
                return feature.properties.LandUse === 'Residential';
            },
            style: {
                fillColor: '#964B00',
                fillOpacity: 0.8,
                weight: 1,
                color: 'black'
            }
        });


        // Define the options for the Vector Tiles layer
        var townsOptions = {
            maxZoom: 25,
            tolerance: 3,
            debug: 0,
            style: {
                fillColor: "transparent",
                color: "#F2FF00",
            },
            // Define the function to handle each feature
            onEachFeature: function (feature, layer) {
                // Extracting the data from the feature's properties
                const objectId_1 = feature.properties.OBJECTID_1;
                const subCounty = feature.properties.Sub_County;
                const urbanArea = feature.properties.Urban_Area;
                const registration = feature.properties.Registrati;
                const blockNo = feature.properties.Block_No;
                const sheetNo = feature.properties.Sheet_No;
                const plotNo = feature.properties.Plot_No;
                const plotSize = feature.properties.Plot_Size_;
                const shapeLength = feature.properties.SHAPE_Leng;
                const shapeLength1 = feature.properties.Shape_Le_1;
                const shapeArea = feature.properties.SHAPE_Area;

                // Creating a table with the extracted data
                // Creating a table with the extracted data
                const featureData = `
                                                      <table class="feature-table">
                                                        <tr>
                                                          <td>ParcelId:</td>
                                                          <td>${objectId_1}</td>
                                                        </tr>
                                                        <tr>
                                                          <td>Sub County:</td>
                                                          <td>${subCounty}</td>
                                                        </tr>
                                                        <tr>
                                                          <td>Urban Area:</td>
                                                          <td>${urbanArea}</td>
                                                        </tr>
                                                        <tr>
                                                          <td>Registration:</td>
                                                          <td>${registration}</td>
                                                        </tr>
                                                        <tr>
                                                          <td>Block No:</td>
                                                          <td>${blockNo}</td>
                                                        </tr>
                                                        <tr>
                                                          <td>Sheet No:</td>
                                                          <td>${sheetNo}</td>
                                                        </tr>
                                                        <tr>
                                                          <td>Plot No:</td>
                                                          <td>${plotNo}</td>
                                                        </tr>
                                                        <tr>
                                                          <td>Plot Size:</td>
                                                          <td>${plotSize}</td>
                                                        </tr>
                                                        <tr>
                                                          <td>SHAPE_Leng:</td>
                                                          <td>${shapeLength}</td>
                                                        </tr>
                                                        <tr>
                                                          <td>SHAPE_Area:</td>
                                                          <td>${shapeArea}</td>
                                                        </tr>
                                                      </table>
                                                    `;

                // Adding the table to the popup for the feature
                layer.bindPopup(featureData);

            },
        };

        // Create the GeoJSON layer with the data and options
        var townsGeoJSONLayer = L.geoJSON(towns, townsOptions).addTo(map);

        // Define the options for each Vector Tiles layer
        var adminOptions = {
            // Define the options for the administrative layer
            maxZoom: 25,
            minZoom: 16,
            tolerance: 3,
            debug: 0,
            style: {
                fillColor: "transparent",
                color: "red",
            },
        };

        var buildingsOptions = {
            // Define the options for the buildings layer
            maxZoom: 25,
            minZoom: 16,
            tolerance: 3,
            debug: 0,
            style: {
                fillColor: "brown",
                color: "brown",
            },
        };

        var roadOptions = {
            // Define the options for the roads layer
            maxZoom: 25,
            minZoom: 16,
            tolerance: 3,
            debug: 0,
            style: {
                fillColor: "black",
                color: "black",
            },
        };

        var waterOptions = {
            // Define the options for the water layer
            maxZoom: 25,
            minZoom: 16,
            tolerance: 3,
            debug: 0,
            style: {
                fillColor: "blue",
                color: "blue",
            },
        };

        var vegetationOptions = {
            // Define the options for the vegetation layer
            maxZoom: 25,
            minZoom: 16,
            tolerance: 3,
            debug: 0,
            style: {
                fillColor: "green",
                color: "green",
            },
        };


        // Create the GeoJSON layers with the data and options
        var adminGeoJSONLayer = L.geoJSON(admin, adminOptions);
        var buildingsGeoJSONLayer = L.geoJSON(buildings, buildingsOptions);
        var roadGeoJSONLayer = L.geoJSON(roads, roadOptions);
        var waterGeoJSONLayer = L.geoJSON(water, waterOptions);
        var vegetationGeoJSONLayer = L.geoJSON(vegetation, vegetationOptions);

        // Create the layer control and add the base layers
        var baseLayers = {
            Satellite: satelliteLayer,
            OSM: osmLayer
        };

        // Create the layer control and add the base layers
        var layerControl = L.control.groupedLayers(baseLayers, null, {
            collapsed: false,
            minZoom: 14 // Set the minimum zoom level for the layer control
        }).addTo(map);


        // Create separate layer groups
        var townsGroup = L.layerGroup().addLayer(townsGeoJSONLayer);
        var adminGroup = L.layerGroup().addLayer(adminGeoJSONLayer);
        var buildingsGroup = L.layerGroup().addLayer(buildingsGeoJSONLayer);
        var roadsGroup = L.layerGroup().addLayer(roadGeoJSONLayer);
        var waterGroup = L.layerGroup().addLayer(waterGeoJSONLayer);
        var vegetationGroup = L.layerGroup().addLayer(vegetationGeoJSONLayer);
      

        // Add the layer groups to the layer control with expandable headers
        layerControl.addOverlay(townsGroup, "Parcels", "Cadastral Data");
        layerControl.addOverlay(adminGroup, "Township Ward", "Administrative Boundaries");
        layerControl.addOverlay(buildingsGroup, "Buildings", "Construm Data");
        layerControl.addOverlay(roadsGroup, "Roads", "Construm Data");
        layerControl.addOverlay(waterGroup, "Water", "Construm Data");
        layerControl.addOverlay(vegetationGroup, "Vegetation", "Construm Data");
        layerControl.addOverlay(agriculturalLayer, 'Agricultural', 'Landuse');
        layerControl.addOverlay(industrialLayer, 'Industrial', 'Landuse');
        layerControl.addOverlay(commercialLayer, 'Commercial', 'Landuse');
        layerControl.addOverlay(residentialLayer, 'Residential', 'Landuse');


        // Add event listeners to handle layer control changes
        map.on("overlayadd", function (eventLayer) {
            // Switch on the layer
            eventLayer.layer.addTo(map);
        });

        map.on("overlayremove", function (eventLayer) {
            // Switch off the layer
            eventLayer.layer.removeFrom(map);
        });

        // Get the HTML container for the layer
        var htmlObject = layerControl.getContainer();
        // Add the HTML container to the sidebar
        var a = document.getElementById('layer-control');
        a.appendChild(htmlObject);


        document.addEventListener('DOMContentLoaded', function () {
            // Create the sidebar and add it to the map
            var sidebar = L.control.sidebar('sidebar', {
                closeButton: true,
                position: 'left'
            }).addTo(map);

            // Get the layer toggle button element
            const layerToggleButton = document.getElementById('layer-control');

            // Add a click event listener to the button
            layerToggleButton.addEventListener('click', function () {
                // Toggle the 'collapsed' class on the sidebar container
                sidebar.getContainer().classList.toggle('collapsed');
            });

            // Get the home tab element
            var homeTab = document.querySelector('a[href="#home"]');

            // Set the home tab as active
            homeTab.classList.add('active');
        });



        var marker = L.marker([0.2808, 34.7557]).addTo(map);

        var sidebar = L.control.sidebar('sidebar').addTo(map);



        // Create a geocoder using Mapbox provider
        /**var geocoder = L.Control.geocoder({
            defaultMarkGeocode: false,
            collapsed: false,
            placeholder: "Enter a location to search",
            errorMessage: "Nothing found.",
            geocoder: L.Control.Geocoder.mapbox('pk.eyJ1Ijoic2ltaW9uMTIzIiwiYSI6ImNsZzZkaGJtcjBjZG8zcnFpcG1icHZ0MWEifQ.qs9HmzJglua2mUBOnoahQQ')
        }).on("markgeocode", function (e) {
            map.fitBounds(e.geocode.bbox);
        }).addTo(map);

        // Handle search on Enter key press
        document.getElementById("search-input").addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
                geocoder.options.geocoder.geocode(document.getElementById("search-input").value);
            }
        });

        // Add geocoder control to the sidebar search pane
        var searchPane = document.getElementById('search');
        searchPane.appendChild(geocoder.getContainer());**/



        // Define options for browser print control
        var options = {
            title: 'Print Map',
            position: 'bottomleft'
        };

        // Create browser print control with options and add it to the map
        var browserControl = L.control.browserPrint(options).addTo(map);

        var options = {
            position: 'bottomleft',
            lengthUnit: {
                factor: 0.539956803,    // from km to nm
                display: 'meters',
                decimal: 2
            }
        };

        // Create ruler control with options and add it to the map
        L.control.ruler(options).addTo(map);

        // Variables
        var searchedPlotLayer = L.geoJSON(null, {
            style: function (feature) {
                return {
                    color: 'red',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 1
                };
            }
        });
        var townsLayer = L.geoJSON(towns, townsOptions);
        var matchingPlotCount = 0;

        // Add event listener to the search button
        document.getElementById('search-button').addEventListener('click', searchByPlotNumber);

        // Add event listener to the search input field
        document.getElementById('search-input').addEventListener('keypress', function (event) {
            // Check if the Enter key is pressed
            if (event.key === 'Enter') {
                searchByPlotNumber();
            }
        });

        // Keep track of the current searched features
        var currentSearchedFeatures = [];

        // Function to handle the search based on the plot number
        function searchByPlotNumber() {
            var plotNumber = document.getElementById('search-input').value;

            // Clear existing searched plot layer and reset matching plot count
            searchedPlotLayer.clearLayers();
            matchingPlotCount = 0;

            // Filter the features based on the plot number and add them to the searched plot layer
            var searchedFeaturesTowns = towns.features.filter(function (feature) {
                return feature.properties['Plot_No'] === plotNumber;
            });

            if (searchedFeaturesTowns.length > 0) {
                searchedFeaturesTowns.forEach(function (feature) {
                    searchedPlotLayer.addData(feature);
                });

                // Fit the map bounds to the searched plot layer
                var bounds = searchedPlotLayer.getBounds();
                map.fitBounds(bounds.pad(0.2)); // Adjust padding value as needed

                matchingPlotCount = searchedFeaturesTowns.length;

                if (matchingPlotCount > 1) {
                    displayMessage('Multiple plots found!', 'green');
                } else {
                    hideMessage();
                }

                // Update the current searched features
                currentSearchedFeatures = searchedFeaturesTowns;

                // Display attribute table
                displayAttributeTable();
            } else {
                alert('Plot not found!');
                hideMessage();
                closeAttributeTable(); // Close the attribute table if no plot is found
            }
        }

        // Function to display the attribute table
        function displayAttributeTable() {
            var tableHTML = '<table>';

            // Create table header
            tableHTML += '<tr>';
            tableHTML += '<th>Parcel ID</th>';
            tableHTML += '<th>Sub County</th>';
            tableHTML += '<th>Urban Area</th>';
            tableHTML += '<th>Registration</th>';
            tableHTML += '<th>Block Number</th>';
            tableHTML += '<th>Sheet Number</th>';
            tableHTML += '<th>Plot Number</th>';
            tableHTML += '<th>Plot Size</th>';
            tableHTML += '<th>Shape Length</th>';
            tableHTML += '<th>Shape Length 1</th>';
            tableHTML += '<th>Shape Area</th>';
            tableHTML += '</tr>';

            // Create table rows with feature attributes
            currentSearchedFeatures.forEach(function (feature) {
                var properties = feature.properties;
                tableHTML += '<tr>';
                tableHTML += '<td>' + properties.OBJECTID_1 + '</td>';
                tableHTML += '<td>' + properties.Sub_County + '</td>';
                tableHTML += '<td>' + properties.Urban_Area + '</td>';
                tableHTML += '<td>' + properties.Registrati + '</td>';
                tableHTML += '<td>' + properties.Block_No + '</td>';
                tableHTML += '<td>' + properties.Sheet_No + '</td>';
                tableHTML += '<td>' + properties.Plot_No + '</td>';
                tableHTML += '<td>' + properties.Plot_Size_ + ' sq.m</td>';
                tableHTML += '<td>' + properties.SHAPE_Leng + '</td>';
                tableHTML += '<td>' + properties.Shape_Le_1 + '</td>';
                tableHTML += '<td>' + properties.SHAPE_Area + '</td>';
                tableHTML += '</tr>';
            });

            tableHTML += '</table>';

            var attributeTable = document.getElementById('attribute-table');
            attributeTable.innerHTML = tableHTML;
        }

        // Bind the event listener for the ESC key
        document.addEventListener('keyup', function (event) {
            // Check if the ESC key is pressed
            if (event.key === 'Escape') {
                var attributeTable = document.getElementById('attribute-table');
                attributeTable.innerHTML = ''; // Clear the table content
            }
        });



        // Function to display the message container
        function displayMessage(message, color) {
            var messageContainer = document.getElementById('message-container');
            if (messageContainer) {
                messageContainer.innerText = message;
                messageContainer.style.backgroundColor = color;
                messageContainer.style.color = 'white';
                messageContainer.style.display = 'block';
            }
        }

        // Function to hide the message container
        function hideMessage() {
            var messageContainer = document.getElementById('message-container');
            if (messageContainer) {
                messageContainer.style.display = 'none';
            }
        }

        // Add the searched plot layer to the map
        searchedPlotLayer.addTo(map);

        // Add click event listener to the searched plot layer
        searchedPlotLayer.eachLayer(function (layer) {
            layer.on('click', function (event) {
                var properties = event.target.feature.properties;
                var objectId = properties.OBJECTID;
                var subCounty = properties.Sub_County;
                var urbanArea = properties.Urban_Area;
                var registration = properties.Registrati;
                var blockNo = properties.Block_No;
                var sheetNo = properties.Sheet_No;
                var plotNo = properties.Plot_No;
                var plotSize = properties.Plot_Size_;
                var shapeLength = properties.SHAPE_Leng;
                var shapeLength1 = properties.Shape_Le_1;
                var shapeArea = properties.SHAPE_Area;

                var popupContent =
                    '<b>Object ID:</b> ' + objectId + '<br>' +
                    '<b>Sub County:</b> ' + subCounty + '<br>' +
                    '<b>Urban Area:</b> ' + urbanArea + '<br>' +
                    '<b>Registration:</b> ' + registration + '<br>' +
                    '<b>Block Number:</b> ' + blockNo + '<br>' +
                    '<b>Sheet Number:</b> ' + sheetNo + '<br>' +
                    '<b>Plot Number:</b> ' + plotNo + '<br>' +
                    '<b>Plot Size:</b> ' + plotSize + ' sq.m' + '<br>' +
                    '<b>Shape Length:</b> ' + shapeLength + '<br>' +
                    '<b>Shape Length 1:</b> ' + shapeLength1 + '<br>' +
                    '<b>Shape Area:</b> ' + shapeArea;

                layer.bindPopup(popupContent).openPopup();
            });
        });

        //Administartors
        document.addEventListener("DOMContentLoaded", function () {
            const resultTable = document.getElementById("result-table");
            const resultTableHeader = document.getElementById("result-table-header");
            let resultTableContent; // Declare the variable here

            // Assign the resultTableContent variable
            resultTableContent = document.getElementById("result-table-content");

            const resultTableHeading = document.getElementById("result-table-heading");
            const queryButton = document.getElementById("query-button");
            const clearButton = document.getElementById("clear-button");

            function formatDate(dateString) {
                if (!dateString) {
                    return "";
                }
                const date = new Date(dateString);
                if (isNaN(date)) {
                    return "";
                }
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, "0");
                const day = String(date.getDate()).padStart(2, "0");
                return `${year}-${month}-${day}`;
            }

            function handleQuery() {
                // Clear previous results
                resultTableContent.innerHTML = "";
                resultTableHeader.innerHTML = "";

                // Get the selected layer type from the dropdown
                const layerType = document.getElementById("layer-type").value;

                // Retrieve the input values from the form
                const parcelId = document.getElementById("id").value;

                // Choose the appropriate API endpoint based on the selected layer type
                let apiEndpoint;
                let fields;
                switch (layerType) {
                    case "parcels":
                        apiEndpoint = `https://localhost:7225/api/Parcels/${parcelId}`;
                        fields = ["parcelId", "owner", "plotSize", "plotNumber"];
                        break;
                    case "survey":
                        apiEndpoint = `https://localhost:7225/api/Survey/${parcelId}`;
                        fields = ["parcelId", "x_Coordinate", "y_Coordinate"];
                        break;
                    case "revenue":
                        apiEndpoint = `https://localhost:7225/api/Revenue/${parcelId}`;
                        fields = ["parcelId", "paymentDate", "paymentAmount"];
                        break;
                    case "valuation":
                        apiEndpoint = `https://localhost:7225/api/Valuation/${parcelId}`;
                        fields = ["parcelId", "value", "location", "plotSize"];
                        break;
                    default:
                        // Handle unsupported layer types
                        return;
                }

                // Make an AJAX request to the API endpoint with the query parameters
                fetch(apiEndpoint)
                    .then((response) => response.json())
                    .then((data) => {
                        // Populate the form fields with the retrieved data
                        document.getElementById("id").value = data.parcelId;
                        document.getElementById("plot-size").value = data.plotSize;
                        document.getElementById("plot-number").value = data.plotNumber;
                        document.getElementById("version-status").value = data.versionStatus;
                        document.getElementById("geometry-type").value = data.geometryType;
                        document.getElementById("last-change-from").value = formatDate(
                            data.lastChangeFrom
                        );
                        document.getElementById("last-change-to").value = formatDate(
                            data.lastChangeTo
                        );
                        document.getElementById("owner-name").value = data.owner;

                        // Create the header row
                        const headerRow = document.createElement("tr");
                        fields.forEach((field) => {
                            const headerCell = document.createElement("th");
                            headerCell.textContent = field.charAt(0).toUpperCase() + field.slice(1); // Capitalize the column names
                            headerRow.appendChild(headerCell);
                        });
                        resultTableHeader.appendChild(headerRow);

                        // Process the API response and generate the result content dynamically
                        if (Array.isArray(data)) {
                            // For array responses like buildings or survey
                            data.forEach((item) => {
                                const itemContainer = document.createElement("tr");
                                fields.forEach((field) => {
                                    const fieldCell = document.createElement("td");
                                    fieldCell.textContent = item[field];
                                    fieldCell.style.textAlign = "left"; // Align values to the right
                                    itemContainer.appendChild(fieldCell);
                                });
                                resultTableContent.appendChild(itemContainer);
                            });
                        } else {
                            // For single object responses like parcels, revenue, or valuation
                            const itemContainer = document.createElement("tr");
                            fields.forEach((field) => {
                                const fieldCell = document.createElement("td");
                                fieldCell.textContent = data[field];
                                fieldCell.style.textAlign = "left"; // Align values to the right
                                itemContainer.appendChild(fieldCell);
                            });
                            resultTableContent.appendChild(itemContainer);
                        }

                        // Set the table heading to the selected layer type
                        resultTableHeading.textContent =
                            layerType.charAt(0).toUpperCase() + layerType.slice(1);

                        // Show the result table
                        resultTable.style.display = "table";
                    })
                    .catch((error) => {
                        console.error("Error: ", error);
                        // Handle any error that occurred during the API request
                    });
            }

            function handleClear() {
                // Clear form fields
                document.getElementById("layer-type").value = "parcels";
                document.getElementById("id").value = "";
                document.getElementById("version-status").value = "draft";
                document.getElementById("geometry-type").value = "point";
                document.getElementById("last-change-from").value = "";
                document.getElementById("last-change-to").value = "";
                document.getElementById("plot-number").value = "";
                document.getElementById("plot-size").value = "";

                // Clear previous results
                resultTableContent.innerHTML = "";
                resultTableHeader.innerHTML = ""; // Clear the table headings as well
                resultTable.style.display = "none";

                // Reload the application
                location.reload();
            }

            function attachEventListeners() {
                if (queryButton) {
                    queryButton.addEventListener("click", handleQuery);
                }

                if (clearButton) {
                    clearButton.addEventListener("click", handleClear);
                }
            }

            attachEventListeners();
        });

        //logout
        function confirmLogout() {
            var confirmation = confirm("Are you sure you want to logout?");
            if (confirmation) {
                logout();
            }
        }

        function logout() {
            // Make an AJAX request to the logout endpoint
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "https://localhost:7225/api/login/api/logout", true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    // Logout successful, redirect to the login page or perform any other action
                    window.location.href = "login.html";
                } else {
                    // Logout failed, handle the error
                    console.error("Logout failed");
                }
            };
            xhr.send();
        }

        //Profile Form
        function toggleProfileForm() {
            var profileFormContainer = document.getElementById("profileFormContainer");
            profileFormContainer.style.display = (profileFormContainer.style.display === "none") ? "block" : "none";
        }

        // Function to get the user's first name from the URL parameter
        function getFirstNameFromURL() {
            var searchParams = new URLSearchParams(window.location.search);
            return searchParams.get('fullname');
        }

        // Get the user's first name from the URL parameter
        var firstName = getFirstNameFromURL();

        if (firstName) {
            // Create the welcome message element
            var welcomeMessage = document.createElement("span");
            welcomeMessage.textContent = "Welcome, " + firstName + "!";
            welcomeMessage.style.marginRight = "10px";

            // Create the profile icon element
            var profileIcon = document.createElement("i");
            profileIcon.className = "fas fa-user-circle";

            // Insert the welcome message and profile icon into the title section
            var userWelcome = document.getElementById("user-welcome");
            userWelcome.appendChild(welcomeMessage);

        }

        function toggleAnswer(index) {
            var answer = document.getElementById("answer" + index);
            answer.style.display = answer.style.display === "none" ? "block" : "none";
        }

    </script>
</body>
</html>


